import sqlite3
import telebot
import logging
# import sqlite3 # –Ø–∫—â–æ —Ö–æ—á–µ—Ç–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –¥–∞–Ω—ñ –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö SQLite

# --- 1. –í–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ ---
TOKEN = '8039977178:AAGS-GbH-lhljGGG6OgJ2iMU_ncB-JzeOvU' # <--- –í–°–¢–ê–í–¢–ï –°–Æ–î–ò –í–ê–® –†–ï–ê–õ–¨–ù–ò–ô –¢–û–ö–ï–ù

# --- 2. ID –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ---
# –ó–Ω–∞–π–¥—ñ—Ç—å —Å–≤—ñ–π chat_id —á–µ—Ä–µ–∑ @userinfobot —É Telegram —ñ –≤—Å—Ç–∞–≤—Ç–µ –π–æ–≥–æ —Å—é–¥–∏.
# –¶–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è —Å–ø–æ–≤—ñ—â–µ–Ω—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É –ø—Ä–æ –Ω–æ–≤—ñ —Ç–æ–≤–∞—Ä–∏.
ADMIN_CHAT_ID = 8184456641 # <--- –ó–ê–ú–Ü–ù–Ü–¢–¨ –ù–ê –í–ê–® –†–ï–ê–õ–¨–ù–ò–ô CHAT_ID –ê–î–ú–Ü–ù–ê (–¶–ï –¶–ò–§–†–ò)
# –ù–∞–ø—Ä–∏–∫–ª–∞–¥: ADMIN_CHAT_ID = 123456789

# --- 3. ID –∫–∞–Ω–∞–ª—É –¥–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ–π ---
# –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä–∏ –≤ –∫–∞–Ω–∞–ª.
# –ó–Ω–∞–π–¥—ñ—Ç—å ID –∫–∞–Ω–∞–ª—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —á–µ—Ä–µ–∑ @get_id_bot, –∞–±–æ –ø–µ—Ä–µ—Å–ª–∞–≤—à–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –∫–∞–Ω–∞–ª—É –±–æ—Ç—É)
# ID –∫–∞–Ω–∞–ª—É –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ '-100'
CHANNEL_ID = -1002535586055 # <--- –ó–ê–ú–Ü–ù–Ü–¢–¨ –ù–ê –†–ï–ê–õ–¨–ù–ò–ô ID –ö–ê–ù–ê–õ–£ (–ù–ê–ü–†–ò–ö–õ–ê–î: -1001234567890)
# –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∞—à –±–æ—Ç —î –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∫–∞–Ω–∞–ª—É –∑ –ø—Ä–∞–≤–æ–º –ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.


# --- 4. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–æ—Ç–∞ ---
bot = telebot.TeleBot(TOKEN)

# --- 5. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è ---
logging.basicConfig(level=logging.INFO, 
                    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
                    handlers=[
                        logging.FileHandler("bot.log"), # –ó–∞–ø–∏—Å—É–≤–∞—Ç–∏ –ª–æ–≥–∏ —É —Ñ–∞–π–ª
                        logging.StreamHandler()        # –í–∏–≤–æ–¥–∏—Ç–∏ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—å
                    ])
logger = logging.getLogger(__name__)

# --- 6. –ó–º—ñ–Ω–Ω–∞ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ ---
user_data = {} # chat_id: {'step': 'current_step', 'product_name': '', 'price': '', 'description': '', 'photos': []}

# --- 7. –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ /start ---
@bot.message_handler(commands=['start'])
def send_welcome(message):
    chat_id = message.chat.id
    username = message.from_user.first_name if message.from_user.first_name else "–¥—Ä—É–∂–µ"
    
    welcome_text = (
        f"–ü—Ä–∏–≤—ñ—Ç, {username}! üëã –Ø —Ç–≤—ñ–π **Sellerbot**. \n"
        f"–Ø –¥–æ–ø–æ–º–æ–∂—É —Ç–æ–±—ñ –ª–µ–≥–∫–æ –ø—Ä–æ–¥–∞–≤–∞—Ç–∏ —Ç–∞ –∫—É–ø—É–≤–∞—Ç–∏ —Ç–æ–≤–∞—Ä–∏ —É –Ω–∞—à–æ–º—É –∫–æ–º'—é–Ω—ñ—Ç—ñ. \n\n"
        f"‚úÖ –©–æ–± **–ø—Ä–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä**, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π –∫–æ–º–∞–Ω–¥—É /sell\n"
        f"‚û°Ô∏è –©–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è **–ø—Ä–∞–≤–∏–ª–∞ —Ç–∞ –∫–æ–º—ñ—Å—ñ—é**, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π /rules\n"
        f"üí∞ –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ **–¥–æ—Å—Ç—É–ø–Ω—ñ —Ç–æ–≤–∞—Ä–∏** –º–æ–∂–Ω–∞ —Ç—É—Ç: [–ù–∞—à –∫–∞–Ω–∞–ª]({CHANNEL_ID if str(CHANNEL_ID).startswith('-100') else 'https://t.me/your_channel_link_here'}) \n\n" # –ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
        f"–ó–≤–µ—Ä–Ω–∏ —É–≤–∞–≥—É: –Ω–∞—à –±–æ—Ç –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î –æ—Å–æ–±–∏—Å—Ç—ñ –¥–∞–Ω—ñ, –æ–∫—Ä—ñ–º —Ç–∏—Ö, —â–æ —Ç–∏ —Å–∞–º –Ω–∞–¥–∞—î—à –¥–ª—è –æ–≥–æ–ª–æ—à–µ–Ω—å."
    )
    bot.send_message(chat_id, welcome_text, parse_mode='Markdown', disable_web_page_preview=True)
    logger.info(f"–ö–æ–º–∞–Ω–¥–∞ /start –≤—ñ–¥ {chat_id} ({username})")

# --- 8. –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ /rules ---
@bot.message_handler(commands=['rules'])
def send_rules(message):
    chat_id = message.chat.id
    rules_text = (
        f"üìú **–ü—Ä–∞–≤–∏–ª–∞ —Ç–∞ —É–º–æ–≤–∏ –ø—Ä–æ–¥–∞–∂—É:** üìú\n\n"
        f"1.  **–ö–æ–º—ñ—Å—ñ—è:** –ú–∏ –±–µ—Ä–µ–º–æ **10% –∫–æ–º—ñ—Å—ñ—ó** –≤—ñ–¥ –≤–∞—Ä—Ç–æ—Å—Ç—ñ –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–æ–¥–∞–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É. –ö–æ–º—ñ—Å—ñ—è —Å–ø–ª–∞—á—É—î—Ç—å—Å—è –ø—Ä–æ–¥–∞–≤—Ü–µ–º –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —É–≥–æ–¥–∏.\n"
        f"    * **–°–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏:** –ö–æ–º—ñ—Å—ñ—é –º–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ –Ω–∞ **Monobank** (–Ω–æ–º–µ—Ä –∫–∞—Ä—Ç–∏ –±—É–¥–µ –Ω–∞–¥–∞–Ω–æ –ø—ñ—Å–ª—è –ø—Ä–æ–¥–∞–∂—É) –∞–±–æ **–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ—é** (–∞–¥—Ä–µ—Å–∞ –≥–∞–º–∞–Ω—Ü—è –±—É–¥–µ –Ω–∞–¥–∞–Ω–∞).\n"
        f"    * **–¢–µ—Ä–º—ñ–Ω –æ–ø–ª–∞—Ç–∏:** –ü—Ä–æ—Ç—è–≥–æ–º 24 –≥–æ–¥–∏–Ω –ø—ñ—Å–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø—Ä–æ–¥–∞–∂.\n"
        f"    * **–ù–∞—Å–ª—ñ–¥–∫–∏ –Ω–µ—Å–ø–ª–∞—Ç–∏:** –ù–µ—Å–ø–ª–∞—Ç–∞ –∫–æ–º—ñ—Å—ñ—ó –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –≤–∞—à–æ–≥–æ –∞–∫–∞—É–Ω—Ç—É –¥–ª—è –ø–æ–¥–∞–ª—å—à–∏—Ö –ø—Ä–æ–¥–∞–∂—ñ–≤.\n\n"
        f"2.  **–ü–æ—Ä—è–¥–æ–∫ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è:** –í–∞—à–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –ø–æ–≤–∏–Ω–Ω–æ –º—ñ—Å—Ç–∏—Ç–∏:\n"
        f"    * **–Ø–∫—ñ—Å–Ω–µ —Ñ–æ—Ç–æ:** –ß—ñ—Ç–∫–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É (–º–æ–∂–Ω–∞ –∫—ñ–ª—å–∫–∞).\n"
        f"    * **–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É:** –ö–æ—Ä–æ—Ç–∫–æ —Ç–∞ –∑—Ä–æ–∑—É–º—ñ–ª–æ.\n"
        f"    * **–î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å:** –°—Ç–∞–Ω, –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ, –∫–æ–º–ø–ª–µ–∫—Ç, –ø—Ä–∏—á–∏–Ω–∏ –ø—Ä–æ–¥–∞–∂—É —Ç–æ—â–æ.\n"
        f"    * **–¶—ñ–Ω–∞:** –û–±–æ–≤'—è–∑–∫–æ–≤–æ –≤–∫–∞–∑–∞—Ç–∏ –≤–∞–ª—é—Ç—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 1000 UAH –∞–±–æ 30$).\n"
        f"    * **–ú—ñ—Å—Ü–µ –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è:** –ú—ñ—Å—Ç–æ –∞–±–æ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏.\n"
        f"    * *(–ó–∞ –±–∞–∂–∞–Ω–Ω—è–º) –ö–æ–Ω—Ç–∞–∫—Ç –ø—Ä–æ–¥–∞–≤—Ü—è: –ó–∞–∑–≤–∏—á–∞–π —Ü–µ –≤–∞—à Telegram-–Ω—ñ–∫, —è–∫–∏–π –±–æ—Ç –¥–æ–¥–∞—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.*\n\n"
        f"3.  **–ú–æ–¥–µ—Ä–∞—Ü—ñ—è:** –í—Å—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –ø—Ä–æ—Ö–æ–¥—è—Ç—å –º–æ–¥–µ—Ä–∞—Ü—ñ—é –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º. –ú–∏ –∑–∞–ª–∏—à–∞—î–º–æ –∑–∞ —Å–æ–±–æ—é –ø—Ä–∞–≤–æ –≤—ñ–¥–º–æ–≤–∏—Ç–∏ –≤ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–Ω—è –ø—Ä–∏—á–∏–Ω, —è–∫—â–æ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø—Ä–∞–≤–∏–ª–∞–º –∞–±–æ —Ç–µ–º–∞—Ç–∏—Ü—ñ –∫–∞–Ω–∞–ª—É.\n\n"
        f"4.  **–í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å:** –ú–∏ —î –ª–∏—à–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ—é –¥–ª—è —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω—å. –í—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å –∑–∞ —è–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—É, –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –æ–ø–∏—Å—É —Ç–∞ –±–µ–∑–ø–µ–∫—É —É–≥–æ–¥–∏ –ª–µ–∂–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–≤—Ü—ñ —Ç–∞ –ø–æ–∫—É–ø—Ü—ñ.\n\n"
        f"–î—è–∫—É—î–º–æ –∑–∞ —Ä–æ–∑—É–º—ñ–Ω–Ω—è —Ç–∞ –±–∞–∂–∞—î–º–æ —É—Å–ø—ñ—à–Ω–∏—Ö –ø—Ä–æ–¥–∞–∂—ñ–≤!"
    )
    bot.send_message(chat_id, rules_text, parse_mode='Markdown')
    logger.info(f"–ö–æ–º–∞–Ω–¥–∞ /rules –≤—ñ–¥ {chat_id}")

# --- 9. –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ /sell ---
@bot.message_handler(commands=['sell'])
def handle_sell_command(message):
    chat_id = message.chat.id
    logger.info(f"–ö–æ–º–∞–Ω–¥–∞ /sell –≤—ñ–¥ {chat_id}")

    # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –ø—Ä–æ—Ü–µ—Å –ø—Ä–æ–¥–∞–∂—É
    if chat_id in user_data:
        bot.send_message(chat_id, "–í–∏ –≤–∂–µ —Ä–æ–∑–ø–æ—á–∞–ª–∏ –ø—Ä–æ—Ü–µ—Å –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É. –ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–≤–µ—Ä—à—ñ—Ç—å –π–æ–≥–æ –∞–±–æ —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è /cancel –¥–ª—è –≤—ñ–¥–º—ñ–Ω–∏.")
        return

    # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –¥–∞–Ω—ñ –¥–ª—è —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —ñ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø–µ—Ä—à–∏–π –∫—Ä–æ–∫
    user_data[chat_id] = {'step': 'waiting_for_product_name', 'photos': []}
    bot.send_message(chat_id,
                     "–î–æ–±—Ä–µ, –ø–æ—á–Ω—ñ–º–æ –ø—Ä–æ—Ü–µ—Å –ø—Ä–æ–¥–∞–∂—É. \n"
                     "–ë—É–¥—å –ª–∞—Å–∫–∞, **–Ω–∞–ø–∏—à—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–æ–≤–∞—Ä—É**, —è–∫–∏–π –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—Ä–æ–¥–∞—Ç–∏.")

# --- 10. –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –≤—ñ–¥–º—ñ–Ω–∏ –ø—Ä–æ—Ü–µ—Å—É ---
@bot.message_handler(commands=['cancel'])
def handle_cancel_command(message):
    chat_id = message.chat.id
    if chat_id in user_data:
        del user_data[chat_id]
        bot.send_message(chat_id, "–ü—Ä–æ—Ü–µ—Å –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É —Å–∫–∞—Å–æ–≤–∞–Ω–æ. –ú–æ–∂–µ—Ç–µ –ø–æ—á–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ, —è–∫—â–æ –±–∞–∂–∞—î—Ç–µ.")
        logger.info(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {chat_id} –≤—ñ–¥–º—ñ–Ω–∏–≤ –ø—Ä–æ—Ü–µ—Å.")
    else:
        bot.send_message(chat_id, "–í–∏ –Ω–µ –ø–µ—Ä–µ–±—É–≤–∞—î—Ç–µ –≤ –ø—Ä–æ—Ü–µ—Å—ñ –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—É.")

# --- 11. –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞–∑–≤–∏ —Ç–æ–≤–∞—Ä—É ---
@bot.message_handler(func=lambda message: message.chat.id in user_data and \
                                         user_data[message.chat.id]['step'] == 'waiting_for_product_name')
def handle_product_name(message):
    chat_id = message.chat.id
    product_name = message.text.strip()

    if not product_name:
        bot.send_message(chat_id, "–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—å–æ—é. –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É.")
        return

    user_data[chat_id]['product_name'] = product_name
    user_data[chat_id]['step'] = 'waiting_for_price'

    logger.info(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {chat_id} –≤–≤—ñ–≤ –Ω–∞–∑–≤—É —Ç–æ–≤–∞—Ä—É: {product_name}")
    bot.send_message(chat_id,
                     f"–ß—É–¥–æ–≤–æ! –í–∏ –ø—Ä–æ–¥–∞—î—Ç–µ **{product_name}**. \n"
                     f"–¢–µ–ø–µ—Ä **–≤–≤–µ–¥—ñ—Ç—å –±–∞–∂–∞–Ω—É —Ü—ñ–Ω—É** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `100 UAH`, `50$`, `—Ü—ñ–Ω–∞ –¥–æ–≥–æ–≤—ñ—Ä–Ω–∞`).")

# --- 12. –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ü—ñ–Ω–∏ —Ç–æ–≤–∞—Ä—É ---
@bot.message_handler(func=lambda message: message.chat.id in user_data and \
                                         user_data[message.chat.id]['step'] == 'waiting_for_price')
def handle_price(message):
    chat_id = message.chat.id
    price = message.text.strip()

    if not price:
        bot.send_message(chat_id, "–¶—ñ–Ω–∞ —Ç–æ–≤–∞—Ä—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—å–æ—é. –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ü—ñ–Ω—É.")
        return

    user_data[chat_id]['price'] = price
    user_data[chat_id]['step'] = 'waiting_for_description'

    logger.info(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {chat_id} –≤–≤—ñ–≤ —Ü—ñ–Ω—É: {price}")
    bot.send_message(chat_id,
                     f"–¶—ñ–Ω–∞ **{price}** –ø—Ä–∏–π–Ω—è—Ç–∞. \n"
                     f"–¢–µ–ø–µ—Ä **–æ–ø–∏—à—ñ—Ç—å –≤–∞—à —Ç–æ–≤–∞—Ä –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ** (—Å—Ç–∞–Ω, –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ, –∫–æ–º–ø–ª–µ–∫—Ç, —Ç–æ—â–æ).")

# --- 13. –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –æ–ø–∏—Å—É —Ç–æ–≤–∞—Ä—É ---
@bot.message_handler(func=lambda message: message.chat.id in user_data and \
                                         user_data[message.chat.id]['step'] == 'waiting_for_description')
def handle_description(message):
    chat_id = message.chat.id
    description = message.text.strip()

    if not description:
        bot.send_message(chat_id, "–û–ø–∏—Å —Ç–æ–≤–∞—Ä—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º. –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –æ–ø–∏—Å.")
        return

    user_data[chat_id]['description'] = description
    user_data[chat_id]['step'] = 'waiting_for_photos'

    logger.info(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {chat_id} –≤–≤—ñ–≤ –æ–ø–∏—Å.")
    bot.send_message(chat_id,
                     f"–û–ø–∏—Å –¥–æ–¥–∞–Ω–æ. –¢–µ–ø–µ—Ä, –±—É–¥—å –ª–∞—Å–∫–∞, **–Ω–∞–¥—ñ—à–ª—ñ—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—ó** –≤–∞—à–æ–≥–æ —Ç–æ–≤–∞—Ä—É (–º–æ–∂–Ω–∞ –∫—ñ–ª—å–∫–∞). "
                     f"–ö–æ–ª–∏ –∑–∞–∫—ñ–Ω—á–∏—Ç–µ, –ø—Ä–æ—Å—Ç–æ –Ω–∞–¥—ñ—à–ª—ñ—Ç—å –±—É–¥—å-—è–∫–µ —Ç–µ–∫—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–±–æ –∫–æ–º–∞–Ω–¥—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `/done`.")

# --- 14. –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ–π ---
# –¶–µ–π –æ–±—Ä–æ–±–Ω–∏–∫ —Å–ø—Ä–∞—Ü—é—î –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —â–æ –º—ñ—Å—Ç–∏—Ç—å —Ñ–æ—Ç–æ,
# —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞ –∫—Ä–æ—Ü—ñ 'waiting_for_photos'
@bot.message_handler(content_types=['photo'],
                     func=lambda message: message.chat.id in user_data and \
                                          user_data[message.chat.id]['step'] == 'waiting_for_photos')
def handle_photos(message):
    chat_id = message.chat.id
    if len(user_data[chat_id]['photos']) >= 10: # –û–±–º–µ–∂–µ–Ω–Ω—è –Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ñ–æ—Ç–æ
        bot.send_message(chat_id, "–í–∏ –≤–∂–µ –Ω–∞–¥—ñ—Å–ª–∞–ª–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ–π (10).")
        return

    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ file_id –Ω–∞–π–±—ñ–ª—å—à–æ—ó –≤–µ—Ä—Å—ñ—ó —Ñ–æ—Ç–æ
    photo_file_id = message.photo[-1].file_id
    user_data[chat_id]['photos'].append(photo_file_id)
    logger.info(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {chat_id} –Ω–∞–¥—ñ—Å–ª–∞–≤ —Ñ–æ—Ç–æ: {photo_file_id}")
    bot.send_message(chat_id, f"–§–æ—Ç–æ –ø—Ä–∏–π–Ω—è—Ç–æ! –ù–∞–¥—ñ—à–ª—ñ—Ç—å —â–µ –∞–±–æ –Ω–∞–¥—ñ—à–ª—ñ—Ç—å –±—É–¥—å-—è–∫–µ —Ç–µ–∫—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `/done`), —â–æ–± –∑–∞–≤–µ—Ä—à–∏—Ç–∏.")

# --- 15. –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤–≤–µ–¥–µ–Ω–Ω—è —Ñ–æ—Ç–æ –∞–±–æ —ñ–Ω—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å ---
@bot.message_handler(func=lambda message: message.chat.id in user_data and \
                                         user_data[message.chat.id]['step'] == 'waiting_for_photos' and \
                                         message.text not in ['/sell', '/start', '/rules', '/cancel'])
def finish_photos_and_send_to_admin(message):
    chat_id = message.chat.id
    
    # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ —î —Ö–æ—á–∞ –± –æ–¥–Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—è, —è–∫—â–æ –Ω–µ –±—É–ª–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ '/done'
    if not user_data[chat_id]['photos']:
        bot.send_message(chat_id, "–ë—É–¥—å –ª–∞—Å–∫–∞, –Ω–∞–¥—ñ—à–ª—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–Ω—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ—é —Ç–æ–≤–∞—Ä—É, –∞–±–æ –≤—ñ–¥–º—ñ–Ω—ñ—Ç—å –ø—Ä–æ—Ü–µ—Å /cancel.")
        return

    # –ó–±–∏—Ä–∞—î–º–æ –≤—Å—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ç–æ–≤–∞—Ä
    product_name = user_data[chat_id]['product_name']
    price = user_data[chat_id]['price']
    description = user_data[chat_id]['description']
    photos_ids = user_data[chat_id]['photos']
    
    # –§–æ—Ä–º—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    final_user_message = (
        f"‚úÖ **–í–∞—à–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!** ‚úÖ\n\n"
        f"–ú–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ –≤–∞—à—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é. –û—Å—å —â–æ –º–∏ –æ—Ç—Ä–∏–º–∞–ª–∏:\n"
        f"**–ù–∞–∑–≤–∞:** {product_name}\n"
        f"**–¶—ñ–Ω–∞:** {price}\n"
        f"**–û–ø–∏—Å:** {description}\n"
        f"**–§–æ—Ç–æ:** ({len(photos_ids)} —à—Ç.)\n\n"
        f"–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å –≤–∞—à–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è, —ñ –º–∏ —Å–∫–æ—Ä–æ –æ–ø—É–±–ª—ñ–∫—É—î–º–æ –π–æ–≥–æ —É –∫–∞–Ω–∞–ª—ñ."
        f"–î—è–∫—É—î–º–æ –∑–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Sellerbot! üòä"
    )
    bot.send_message(chat_id, final_user_message, parse_mode='Markdown')
    logger.info(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {chat_id} –∑–∞–≤–µ—Ä—à–∏–≤ –≤–≤–µ–¥–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—É: {product_name}. –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É.")

    # --- –õ–û–ì–Ü–ö–ê –í–Ü–î–ü–†–ê–í–ö–ò –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–£ –¢–ê –ü–£–ë–õ–Ü–ö–ê–¶–Ü–á ---

    # –°—Ç–≤–æ—Ä—é—î–º–æ MediaGroup –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ–π —Ä–∞–∑–æ–º –∑ —Ç–µ–∫—Å—Ç–æ–º
    media = []
    if photos_ids:
        for i, photo_id in enumerate(photos_ids):
            if i == 0: # –î–æ–¥–∞—î–º–æ –ø—ñ–¥–ø–∏—Å –¥–æ –ø–µ—Ä—à–æ–≥–æ —Ñ–æ—Ç–æ
                caption_text = (
                    f"üîî **–ù–û–í–ï –û–ì–û–õ–û–®–ï–ù–ù–Ø –ù–ê –ú–û–î–ï–†–ê–¶–Ü–Æ!** üîî\n\n"
                    f"**–í—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:** @{message.from_user.username if message.from_user.username else 'ID:' + str(chat_id)}\n"
                    f"**–ö–æ–Ω—Ç–∞–∫—Ç:** [–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —á–∞—Ç –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º](tg://user?id={chat_id})\n\n"
                    f"**–ù–∞–∑–≤–∞:** {product_name}\n"
                    f"**–¶—ñ–Ω–∞:** {price}\n"
                    f"**–û–ø–∏—Å:** {description}\n\n"
                    f"**–î—ñ—ó:** \n"
                    f"/approve_{chat_id}_{len(user_data[chat_id]['photos'])} #id_{chat_id} (–æ–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏)\n" # –¢—É—Ç –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Å–∫–ª–∞–¥–Ω–∞ –ª–æ–≥—ñ–∫–∞ –¥–ª—è approve
                    f"/reject_{chat_id} (–≤—ñ–¥—Ö–∏–ª–∏—Ç–∏)"
                )
                media.append(telebot.types.InputMediaPhoto(photo_id, caption=caption_text, parse_mode='Markdown'))
            else:
                media.append(telebot.types.InputMediaPhoto(photo_id))
    
    # –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É
    if str(ADMIN_CHAT_ID).isdigit(): # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ ADMIN_CHAT_ID —î —á–∏—Å–ª–æ–º (–Ω–µ –∑–∞–≥–ª—É—à–∫–æ—é)
        try:
            if media:
                bot.send_media_group(ADMIN_CHAT_ID, media)
            else: # –Ø–∫—â–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ–π –Ω–µ–º–∞—î, –ø—Ä–æ—Å—Ç–æ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ —Ç–µ–∫—Å—Ç
                admin_notification_text = (
                    f"üîî **–ù–û–í–ï –û–ì–û–õ–û–®–ï–ù–ù–Ø –ù–ê –ú–û–î–ï–†–ê–¶–Ü–Æ!** üîî\n\n"
                    f"**–í—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:** @{message.from_user.username if message.from_user.username else 'ID:' + str(chat_id)}\n"
                    f"**–ö–æ–Ω—Ç–∞–∫—Ç:** [–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —á–∞—Ç –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º](tg://user?id={chat_id})\n\n"
                    f"**–ù–∞–∑–≤–∞:** {product_name}\n"
                    f"**–¶—ñ–Ω–∞:** {price}\n"
                    f"**–û–ø–∏—Å:** {description}\n\n"
                    f"**–î—ñ—ó:** \n"
                    f"/approve_{chat_id} #id_{chat_id} (–æ–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏)\n"
                    f"/reject_{chat_id} (–≤—ñ–¥—Ö–∏–ª–∏—Ç–∏)"
                )
                bot.send_message(ADMIN_CHAT_ID, admin_notification_text, parse_mode='Markdown')
            
            logger.info(f"–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø—Ä–æ –Ω–æ–≤–∏–π —Ç–æ–≤–∞—Ä –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É {ADMIN_CHAT_ID}")
            
            # TODO: –ó–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö —Ç—É—Ç.
            # –ù–∞–ø—Ä–∏–∫–ª–∞–¥:
            # save_to_db(chat_id, product_name, price, description, photos_ids)
            # –ü—Ä–∏–∫–ª–∞–¥ —Ñ—É–Ω–∫—Ü—ñ—ó –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ SQLite:
            # def save_to_db(user_id, name, price, desc, photos):
            #     conn = sqlite3.connect('products.db')
            #     cursor = conn.cursor()
            #     cursor.execute('''
            #         CREATE TABLE IF NOT EXISTS products (
            #             id INTEGER PRIMARY KEY AUTOINCREMENT,
            #             user_id INTEGER,
            #             name TEXT,
            #             price TEXT,
            #             description TEXT,
            #             photos TEXT, # –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ —è–∫ JSON —Ä—è–¥–æ–∫ –∞–±–æ —Ä–æ–∑–¥—ñ–ª–µ–Ω—ñ –∫–æ–º–∏
            #             status TEXT DEFAULT 'pending'
            #         )
            #     ''')
            #     cursor.execute("INSERT INTO products (user_id, name, price, description, photos) VALUES (?, ?, ?, ?, ?)",
            #                    (user_id, name, price, desc, ",".join(photos)))
            #     conn.commit()
            #     conn.close()

        except Exception as e:
            logger.error(f"–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É {ADMIN_CHAT_ID}: {e}")
            bot.send_message(chat_id, "–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É. –ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ –∞–±–æ –∑–≤'—è–∂—ñ—Ç—å—Å—è –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é.")
    else:
        logger.warning("ADMIN_CHAT_ID –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∞–±–æ –Ω–µ —î —á–∏—Å–ª–æ–º. –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É –Ω–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ.")
        bot.send_message(chat_id, "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –í–∞—à —Ç–æ–≤–∞—Ä –Ω–µ –±—É–¥–µ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü—ñ—ó.")


    # –û—á–∏—â–∞—î–º–æ —Å—Ç–∞–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø—Ä–æ—Ü–µ—Å—É
    del user_data[chat_id]

# --- 16. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ ---
logger.info("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω–æ. –ü–æ—á–∞—Ç–æ–∫ polling...")
try:
    bot.polling(none_stop=True, interval=0) # none_stop=True –¥–æ–∑–≤–æ–ª—è—î –±–æ—Ç—É –Ω–µ –∑—É–ø–∏–Ω—è—Ç–∏—Å—è –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö
except Exception as e:
    logger.critical(f"–°—Ç–∞–ª–∞—Å—è –∫—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É polling: {e}")